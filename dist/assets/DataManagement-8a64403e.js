import{_ as Ue,u as De,g as u,j as pe,q as ze,a as f,s as Pe,o as y,c as le,d as l,w as n,E as i,b as c,m as N,v as ae,e as m,x as te,h as z,t as P,F as me,l as ge,y as Se}from"./index-defd5518.js";import{h as Le,i as $e,j as Ie,k as Ee,l as Me,m as Re,n as Fe,o as Ae,p as je,q as Oe}from"./index-9fc1f318.js";import{t as ve,a as fe,g as We}from"./common-9bd3b376.js";const Ge={class:"data-management-container"},He={class:"page-content"},Je={class:"tab-content"},Ke={class:"toolbar"},Qe={class:"tab-content"},Xe={class:"toolbar"},Ye={class:"tab-content"},Ze={class:"toolbar"},el={class:"dialog-footer"},ll={class:"dialog-footer"},al={class:"dialog-footer"},tl={__name:"DataManagement",setup(nl){const S=De(),b=u("crane"),ne=u(""),L=u(1),ie=u(10),oe=u(0),$=u([]),M=u(!1),ue=u(""),h=u(1),I=u(10),de=u(0),E=u([]),R=u(!1),re=u(""),C=u(1),F=u(10),se=u(0),A=u([]),j=u(!1),V=u(!1),O=u(""),r=u({id:"",deviceName:"",deviceType:"",prodBusiness:"",weight:"",length:"",width:"",height:""}),k=u(!1),p=u({liftingType:"",subType:"",liftingName:"",prodBusiness:""}),B=u(!1),s=u({machineName:"",type:"",model:"",prodBusiness:""}),w=u([]),ce=async a=>{if(!a){w.value=[];return}try{const e=await Oe(a);e&&e.code==="0"?w.value=e.data||[]:(w.value=[],i.error((e==null?void 0:e.message)||"获取子类型数据失败"))}catch(e){console.error("获取子类型数据失败:",e),w.value=[],i.error("获取子类型数据失败，请检查网络连接")}},ye=a=>{p.value.subType="",ce(a)},be=()=>{B.value=!0,s.value={machineName:"",type:"",model:"",prodBusiness:""}},he=()=>{k.value=!0,p.value={liftingType:"",subType:"",liftingName:"",prodBusiness:""},w.value=[]},we=()=>{O.value="新建设备",V.value=!0,r.value={id:"",deviceName:"",deviceType:"",prodBusiness:"",weight:"",length:"",width:"",height:""}},W=(a,e)=>{e==="rigging"?S.push({path:`/rigging-detail/${a.id}`,query:{liftingType:a.liftingType,liftingName:a.liftingName,twoLiftingType:a.twoLiftingType,twoLiftingName:a.twoLiftingName,prodBusiness:a.prodBusiness}}):e==="crane"?S.push({path:"/crane-detail",query:{id:a.id,craneName:a.machineName,craneType:a.type,model:a.model,manufacturer:a.prodBusiness}}):e==="equipment"&&(O.value="编辑设备",V.value=!0,r.value={id:a.id||"",deviceName:a.deviceName||"",deviceType:a.deviceType||"",prodBusiness:a.prodBusiness||"",weight:a.weight||"",length:a.length||"",width:a.width||"",height:a.height||""})},G=(a,e)=>{Se.confirm(`确定要删除这条${e==="crane"?"起重机":e==="rigging"?"吊索具":"设备"}数据吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{e==="rigging"?(await Ee(a.id),await T()):e==="crane"?(await Me(a.id),await x()):e==="equipment"&&(await Re(a.id),await q()),i.success("删除成功")}catch(o){console.error("删除失败:",o),i.error("删除失败，请重试")}}).catch(()=>{i.info("已取消删除")})},Ve=async()=>{if(!s.value.machineName){i.warning("请输入起重机名称");return}if(!s.value.type){i.warning("请选择起重机类型");return}if(!s.value.model){i.warning("请输入型号");return}if(!s.value.prodBusiness){i.warning("请输入生产厂家");return}try{const a={machineName:s.value.machineName,type:s.value.type,model:s.value.model,prodBusiness:s.value.prodBusiness},e=await Fe(a);e&&e.code==="0"?(i.success("创建成功"),B.value=!1,S.push({path:"/crane-detail",query:{id:e.data.id,craneName:s.value.machineName,craneType:s.value.type,model:s.value.model,manufacturer:s.value.prodBusiness}})):i.error((e==null?void 0:e.message)||"创建失败")}catch(a){console.error("创建起重机失败:",a),i.error("创建失败，请检查网络连接")}},Te=async()=>{if(!p.value.liftingType){i.warning("请选择吊索具类型");return}if(!p.value.liftingName){i.warning("请输入吊索具名称");return}if(!p.value.prodBusiness){i.warning("请输入生产厂家");return}try{const a={...p.value};if(p.value.subType){const o=w.value.find(U=>U.liftingType===p.value.subType);o&&(a.twoLiftingType=o.liftingType,a.twoLiftingName=o.liftingTypeName)}const e=await Ae(a);e&&e.code==="0"?(i.success("创建成功"),k.value=!1,S.push({path:"/rigging-detail",query:{id:e.data.id,liftingType:p.value.liftingType,liftingName:p.value.liftingName,prodBusiness:p.value.prodBusiness,subType:a.twoLiftingType||"",subTypeName:a.twoLiftingName||""}})):i.error((e==null?void 0:e.message)||"创建失败")}catch(a){console.error("创建吊索具失败:",a),i.error("创建失败，请检查网络连接")}},x=async()=>{M.value=!0;try{const a=await Le({pageNum:L.value,pageSize:ie.value});if(a&&a.code==="0"){const e=a.data.records||[];$.value=e.map(o=>({...o,type:ve(o.type)})),oe.value=a.data.total||0}else i.error((a==null?void 0:a.message)||"获取起重机数据失败")}catch(a){console.error("获取起重机数据失败:",a),i.error("获取数据失败，请检查网络连接")}finally{M.value=!1}},_e=a=>{L.value=a,x()},T=async()=>{R.value=!0;try{const a=await $e({pageNum:h.value,pageSize:I.value});if(a&&a.code==="0"){const e=a.data.records||[];E.value=e.map(o=>({...o,liftingType:fe(o.liftingType)})),de.value=a.data.total||0}else i.error((a==null?void 0:a.message)||"获取数据失败")}catch(a){console.error("获取吊索具数据失败:",a),i.error("获取数据失败，请检查网络连接")}finally{R.value=!1}},Ne=a=>{h.value=a,T()};let H=null;const Ce=()=>{H&&clearTimeout(H),H=setTimeout(()=>{h.value=1,T()},500)};pe(b,a=>{a==="rigging"&&E.value.length===0?T():a==="crane"&&$.value.length===0&&x()});const ke=async()=>{if(!r.value.deviceName){i.warning("请输入设备名称");return}if(!r.value.deviceType){i.warning("请输入型号");return}if(!r.value.prodBusiness){i.warning("请输入生产厂家");return}try{const a={...r.value},e=await je(a);e&&e.code==="0"?(i.success(r.value.id?"编辑成功":"创建成功"),V.value=!1,q()):i.error((e==null?void 0:e.message)||"操作失败")}catch(a){console.error("操作失败:",a),i.error("操作失败，请检查网络连接")}},q=async()=>{j.value=!0;try{const a=await Ie({pageNum:C.value,pageSize:F.value});a&&a.code==="0"?(A.value=a.data.records||[],se.value=a.data.total||0):i.error((a==null?void 0:a.message)||"获取设备数据失败")}catch(a){console.error("获取设备数据失败:",a),i.error("获取数据失败，请检查网络连接")}finally{j.value=!1}},Be=a=>{C.value=a,q()};return pe(b,a=>{a==="rigging"&&E.value.length===0?T():a==="crane"&&$.value.length===0?x():a==="equipment"&&A.value.length===0&&q()}),ze(()=>{b.value==="rigging"?T():b.value==="crane"?x():b.value==="equipment"&&q()}),(a,e)=>{const o=f("el-input"),U=f("el-icon"),g=f("el-button"),d=f("el-table-column"),J=f("el-table"),K=f("el-pagination"),Q=f("el-tab-pane"),xe=f("el-tabs"),qe=f("el-card"),v=f("el-form-item"),_=f("el-option"),X=f("el-select"),Y=f("el-form"),Z=f("el-dialog"),ee=Pe("loading");return y(),le("div",Ge,[l(qe,{class:"page-card"},{header:n(()=>[...e[28]||(e[28]=[c("div",{class:"card-header"},[c("span",null,"数据管理")],-1)])]),default:n(()=>[c("div",He,[l(xe,{modelValue:b.value,"onUpdate:modelValue":e[6]||(e[6]=t=>b.value=t),class:"data-tabs"},{default:n(()=>[l(Q,{label:"起重机数据库",name:"crane"},{default:n(()=>[c("div",Je,[c("div",Ke,[l(o,{modelValue:ne.value,"onUpdate:modelValue":e[0]||(e[0]=t=>ne.value=t),placeholder:"搜索","prefix-icon":"Search",style:{width:"240px"},clearable:""},null,8,["modelValue"]),l(g,{type:"primary",onClick:be},{default:n(()=>[l(U,null,{default:n(()=>[l(N(ae))]),_:1}),e[29]||(e[29]=m(" 新建 ",-1))]),_:1})]),te((y(),z(J,{data:$.value,style:{width:"100%"},"header-cell-style":{background:"#f5f7fa"}},{default:n(()=>[l(d,{type:"selection",width:"55"}),l(d,{label:"序号",width:"80"},{default:n(t=>[m(P(t.$index+1+(h.value-1)*I.value),1)]),_:1}),l(d,{prop:"machineName",label:"起重机名称","min-width":"150"}),l(d,{prop:"type",label:"类型","min-width":"120"},{default:n(t=>[m(P(N(ve)(t.row.type)),1)]),_:1}),l(d,{prop:"model",label:"型号","min-width":"150"}),l(d,{prop:"prodBusiness",label:"生产厂家","min-width":"150"}),l(d,{prop:"createName",label:"创建人",width:"120"}),l(d,{prop:"createTime",label:"录入时间",width:"180"}),l(d,{label:"操作",width:"150",fixed:"right"},{default:n(t=>[l(g,{link:"",type:"primary",size:"small",onClick:D=>W(t.row,"crane")},{default:n(()=>[...e[30]||(e[30]=[m(" 编辑 ",-1)])]),_:1},8,["onClick"]),l(g,{link:"",type:"danger",size:"small",onClick:D=>G(t.row,"crane")},{default:n(()=>[...e[31]||(e[31]=[m(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ee,M.value]]),l(K,{"current-page":L.value,"onUpdate:currentPage":e[1]||(e[1]=t=>L.value=t),"page-size":ie.value,total:oe.value,layout:"total, prev, pager, next",class:"pagination",onCurrentChange:_e},null,8,["current-page","page-size","total"])])]),_:1}),l(Q,{label:"吊索具数据库",name:"rigging"},{default:n(()=>[c("div",Qe,[c("div",Xe,[l(o,{modelValue:ue.value,"onUpdate:modelValue":e[2]||(e[2]=t=>ue.value=t),placeholder:"搜索","prefix-icon":"Search",style:{width:"240px"},clearable:"",onInput:Ce},null,8,["modelValue"]),l(g,{type:"primary",onClick:he},{default:n(()=>[l(U,null,{default:n(()=>[l(N(ae))]),_:1}),e[32]||(e[32]=m(" 新建 ",-1))]),_:1})]),te((y(),z(J,{data:E.value,style:{width:"100%"},"header-cell-style":{background:"#f5f7fa"}},{default:n(()=>[l(d,{type:"selection",width:"55"}),l(d,{label:"序号",width:"80"},{default:n(t=>[m(P(t.$index+1+(h.value-1)*I.value),1)]),_:1}),l(d,{prop:"liftingName",label:"吊索具名称","min-width":"150"}),l(d,{prop:"liftingType",label:"类型","min-width":"120"},{default:n(t=>[m(P(N(fe)(t.row.liftingType)),1)]),_:1}),l(d,{prop:"twoLiftingName",label:"子类型",width:"120"}),l(d,{prop:"prodBusiness",label:"生产厂家","min-width":"150"}),l(d,{prop:"createName",label:"创建人",width:"80"}),l(d,{prop:"createTime",label:"录入时间",width:"180"}),l(d,{label:"操作",width:"150",fixed:"right"},{default:n(t=>[l(g,{link:"",type:"primary",size:"small",onClick:D=>W(t.row,"rigging")},{default:n(()=>[...e[33]||(e[33]=[m(" 编辑 ",-1)])]),_:1},8,["onClick"]),l(g,{link:"",type:"danger",size:"small",onClick:D=>G(t.row,"rigging")},{default:n(()=>[...e[34]||(e[34]=[m(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ee,R.value]]),l(K,{"current-page":h.value,"onUpdate:currentPage":e[3]||(e[3]=t=>h.value=t),"page-size":I.value,total:de.value,layout:"total, prev, pager, next",class:"pagination",onCurrentChange:Ne},null,8,["current-page","page-size","total"])])]),_:1}),l(Q,{label:"设备数据库",name:"equipment"},{default:n(()=>[c("div",Ye,[c("div",Ze,[l(o,{modelValue:re.value,"onUpdate:modelValue":e[4]||(e[4]=t=>re.value=t),placeholder:"搜索","prefix-icon":"Search",style:{width:"240px"},clearable:""},null,8,["modelValue"]),l(g,{type:"primary",onClick:we},{default:n(()=>[l(U,null,{default:n(()=>[l(N(ae))]),_:1}),e[35]||(e[35]=m(" 新建 ",-1))]),_:1})]),te((y(),z(J,{data:A.value,style:{width:"100%"},"header-cell-style":{background:"#f5f7fa"}},{default:n(()=>[l(d,{type:"selection",width:"55"}),l(d,{label:"序号",width:"80"},{default:n(t=>[m(P(t.$index+1+(C.value-1)*F.value),1)]),_:1}),l(d,{prop:"deviceName",label:"设备名称","min-width":"150"}),l(d,{prop:"deviceType",label:"型号","min-width":"120"}),l(d,{prop:"prodBusiness",label:"生产厂家","min-width":"150"}),l(d,{prop:"createName",label:"创建人",width:"120"}),l(d,{prop:"createTime",label:"录入时间",width:"180"}),l(d,{label:"操作",width:"150",fixed:"right"},{default:n(t=>[l(g,{link:"",type:"primary",size:"small",onClick:D=>W(t.row,"equipment")},{default:n(()=>[...e[36]||(e[36]=[m(" 编辑 ",-1)])]),_:1},8,["onClick"]),l(g,{link:"",type:"danger",size:"small",onClick:D=>G(t.row,"equipment")},{default:n(()=>[...e[37]||(e[37]=[m(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ee,j.value]]),l(K,{"current-page":C.value,"onUpdate:currentPage":e[5]||(e[5]=t=>C.value=t),"page-size":F.value,total:se.value,layout:"total, prev, pager, next",class:"pagination",onCurrentChange:Be},null,8,["current-page","page-size","total"])])]),_:1})]),_:1},8,["modelValue"])])]),_:1}),l(Z,{modelValue:B.value,"onUpdate:modelValue":e[12]||(e[12]=t=>B.value=t),title:"新建起重机",width:"500px","close-on-click-modal":!1},{footer:n(()=>[c("div",el,[l(g,{onClick:e[11]||(e[11]=t=>B.value=!1)},{default:n(()=>[...e[38]||(e[38]=[m("取消",-1)])]),_:1}),l(g,{type:"primary",onClick:Ve},{default:n(()=>[...e[39]||(e[39]=[m("下一步",-1)])]),_:1})])]),default:n(()=>[l(Y,{model:s.value,"label-width":"100px"},{default:n(()=>[l(v,{label:"起重机名称"},{default:n(()=>[l(o,{modelValue:s.value.machineName,"onUpdate:modelValue":e[7]||(e[7]=t=>s.value.machineName=t),placeholder:"请输入（例如：WDT型）"},null,8,["modelValue"])]),_:1}),l(v,{label:"起重机类型"},{default:n(()=>[l(X,{modelValue:s.value.type,"onUpdate:modelValue":e[8]||(e[8]=t=>s.value.type=t),placeholder:"请选择起重机类型"},{default:n(()=>[(y(!0),le(me,null,ge(N(We)(),t=>(y(),z(_,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(v,{label:"型号"},{default:n(()=>[l(o,{modelValue:s.value.model,"onUpdate:modelValue":e[9]||(e[9]=t=>s.value.model=t),placeholder:"请输入型号"},null,8,["modelValue"])]),_:1}),l(v,{label:"生产厂家"},{default:n(()=>[l(o,{modelValue:s.value.prodBusiness,"onUpdate:modelValue":e[10]||(e[10]=t=>s.value.prodBusiness=t),placeholder:"请输入生产厂家（例如：三一重工）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(Z,{modelValue:k.value,"onUpdate:modelValue":e[18]||(e[18]=t=>k.value=t),title:"新建吊索具",width:"500px","close-on-click-modal":!1},{footer:n(()=>[c("div",ll,[l(g,{onClick:e[17]||(e[17]=t=>k.value=!1)},{default:n(()=>[...e[40]||(e[40]=[m("取消",-1)])]),_:1}),l(g,{type:"primary",onClick:Te},{default:n(()=>[...e[41]||(e[41]=[m("下一步",-1)])]),_:1})])]),default:n(()=>[l(Y,{model:p.value,"label-width":"100px"},{default:n(()=>[l(v,{label:"吊索具名称"},{default:n(()=>[l(o,{modelValue:p.value.liftingName,"onUpdate:modelValue":e[13]||(e[13]=t=>p.value.liftingName=t),placeholder:"请输入吊索具名称"},null,8,["modelValue"])]),_:1}),l(v,{label:"吊索具类型"},{default:n(()=>[l(X,{modelValue:p.value.liftingType,"onUpdate:modelValue":e[14]||(e[14]=t=>p.value.liftingType=t),placeholder:"请选择吊索具类型",onChange:ye},{default:n(()=>[l(_,{label:"钢丝绳",value:"0"}),l(_,{label:"吊带",value:"1"}),l(_,{label:"卸扣",value:"2"}),l(_,{label:"缆绳",value:"3"})]),_:1},8,["modelValue"])]),_:1}),l(v,{label:"子类型"},{default:n(()=>[l(X,{modelValue:p.value.subType,"onUpdate:modelValue":e[15]||(e[15]=t=>p.value.subType=t),placeholder:"请选择子类型"},{default:n(()=>[(y(!0),le(me,null,ge(w.value,t=>(y(),z(_,{key:t.liftingType,label:t.liftingTypeName,value:t.liftingType},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(v,{label:"生产厂家"},{default:n(()=>[l(o,{modelValue:p.value.prodBusiness,"onUpdate:modelValue":e[16]||(e[16]=t=>p.value.prodBusiness=t),placeholder:"请输入生产厂家"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(Z,{modelValue:V.value,"onUpdate:modelValue":e[27]||(e[27]=t=>V.value=t),title:O.value,width:"500px","close-on-click-modal":!1},{footer:n(()=>[c("div",al,[l(g,{onClick:e[26]||(e[26]=t=>V.value=!1)},{default:n(()=>[...e[42]||(e[42]=[m("取消",-1)])]),_:1}),l(g,{type:"primary",onClick:ke},{default:n(()=>[...e[43]||(e[43]=[m("确定",-1)])]),_:1})])]),default:n(()=>[l(Y,{model:r.value,"label-width":"100px"},{default:n(()=>[l(v,{label:"设备名称"},{default:n(()=>[l(o,{modelValue:r.value.deviceName,"onUpdate:modelValue":e[19]||(e[19]=t=>r.value.deviceName=t),placeholder:"请输入设备名称"},null,8,["modelValue"])]),_:1}),l(v,{label:"型号"},{default:n(()=>[l(o,{modelValue:r.value.deviceType,"onUpdate:modelValue":e[20]||(e[20]=t=>r.value.deviceType=t),placeholder:"请输入型号"},null,8,["modelValue"])]),_:1}),l(v,{label:"生产厂家"},{default:n(()=>[l(o,{modelValue:r.value.prodBusiness,"onUpdate:modelValue":e[21]||(e[21]=t=>r.value.prodBusiness=t),placeholder:"请输入生产厂家"},null,8,["modelValue"])]),_:1}),l(v,{label:"重量(kg)"},{default:n(()=>[l(o,{modelValue:r.value.weight,"onUpdate:modelValue":e[22]||(e[22]=t=>r.value.weight=t),placeholder:"请输入重量"},null,8,["modelValue"])]),_:1}),l(v,{label:"长度(m)"},{default:n(()=>[l(o,{modelValue:r.value.length,"onUpdate:modelValue":e[23]||(e[23]=t=>r.value.length=t),placeholder:"请输入长度"},null,8,["modelValue"])]),_:1}),l(v,{label:"宽度(m)"},{default:n(()=>[l(o,{modelValue:r.value.width,"onUpdate:modelValue":e[24]||(e[24]=t=>r.value.width=t),placeholder:"请输入宽度"},null,8,["modelValue"])]),_:1}),l(v,{label:"高度(m)"},{default:n(()=>[l(o,{modelValue:r.value.height,"onUpdate:modelValue":e[25]||(e[25]=t=>r.value.height=t),placeholder:"请输入高度"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},dl=Ue(tl,[["__scopeId","data-v-b1ca9b80"]]);export{dl as default};

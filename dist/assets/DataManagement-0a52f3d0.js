import{_ as Ue,u as He,g as u,j as me,q as De,a as v,s as ze,o as y,c as ee,d as l,w as n,E as o,b as c,m as V,v as le,e as p,x as ae,h as D,t as N,F as ge,l as fe,y as Le}from"./index-74478b48.js";import{g as Pe,t as ve,a as Se,b as te,c as $e,d as Ee,e as Ie,f as Me,h as Re,i as Fe}from"./common-72e607b7.js";const Ae={class:"data-management-container"},Oe={class:"page-content"},je={class:"tab-content"},We={class:"toolbar"},Ge={class:"tab-content"},Je={class:"toolbar"},Ke={class:"tab-content"},Qe={class:"toolbar"},Xe={class:"dialog-footer"},Ye={class:"dialog-footer"},Ze={class:"dialog-footer"},el={__name:"DataManagement",setup(ll){const z=He(),b=u("crane"),ne=u(""),L=u(1),oe=u(10),ie=u(0),P=u([]),R=u(!1),ue=u(""),h=u(1),S=u(10),re=u(0),$=u([]),F=u(!1),de=u(""),E=u(1),se=u(10),pe=u(0),I=u([]),M=u(!1),_=u(!1),A=u(""),d=u({id:"",name:"",type:"",model:"",manufacturer:"",weight:"",length:"",width:"",height:""}),k=u(!1),m=u({liftingType:"",subType:"",liftingName:"",prodBusiness:""}),x=u(!1),s=u({machineName:"",type:"",model:"",prodBusiness:""}),w=u([]),ce=async t=>{if(!t){w.value=[];return}try{const e=await Fe(t);e&&e.code==="0"?w.value=e.data||[]:(w.value=[],o.error((e==null?void 0:e.message)||"获取子类型数据失败"))}catch(e){console.error("获取子类型数据失败:",e),w.value=[],o.error("获取子类型数据失败，请检查网络连接")}},ye=t=>{m.value.subType="",ce(t)},be=()=>{x.value=!0,s.value={machineName:"",type:"",model:"",prodBusiness:""}},he=()=>{k.value=!0,m.value={liftingType:"",subType:"",liftingName:"",prodBusiness:""},w.value=[]},we=()=>{A.value="新建设备",_.value=!0,d.value={id:"",name:"",type:"",model:"",manufacturer:"",weight:"",length:"",width:"",height:""}},O=(t,e)=>{e==="rigging"?z.push({path:`/rigging-detail/${t.id}`,query:{liftingType:t.liftingType,liftingName:t.liftingName,twoLiftingType:t.twoLiftingType,twoLiftingName:t.twoLiftingName,prodBusiness:t.prodBusiness}}):e==="crane"?z.push({path:"/crane-detail",query:{id:t.id,craneName:t.machineName,craneType:t.type,model:t.model,manufacturer:t.prodBusiness}}):e==="equipment"&&(A.value="编辑设备",_.value=!0,d.value={id:t.id||"",name:t.name||"",type:t.type||"",model:t.model||"",manufacturer:t.prodBusiness||"",weight:t.weight||"",length:t.length||"",width:t.width||"",height:t.height||""})},j=(t,e)=>{Le.confirm(`确定要删除这条${e==="crane"?"起重机":e==="rigging"?"吊索具":"设备"}数据吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{e==="rigging"?(await Ee(t.id),await T()):e==="crane"?(await Ie(t.id),await B()):e==="equipment"&&await q(),o.success("删除成功")}catch(i){console.error("删除失败:",i),o.error("删除失败，请重试")}}).catch(()=>{o.info("已取消删除")})},Ve=async()=>{if(!s.value.machineName){o.warning("请输入起重机名称");return}if(!s.value.type){o.warning("请选择起重机类型");return}if(!s.value.model){o.warning("请输入型号");return}if(!s.value.prodBusiness){o.warning("请输入生产厂家");return}try{const t={machineName:s.value.machineName,type:s.value.type,model:s.value.model,prodBusiness:s.value.prodBusiness},e=await Me(t);e&&e.code==="0"?(o.success("创建成功"),x.value=!1,z.push({path:"/crane-detail",query:{id:e.data.id,craneName:s.value.machineName,craneType:s.value.type,model:s.value.model,manufacturer:s.value.prodBusiness}})):o.error((e==null?void 0:e.message)||"创建失败")}catch(t){console.error("创建起重机失败:",t),o.error("创建失败，请检查网络连接")}},_e=async()=>{if(!m.value.liftingType){o.warning("请选择吊索具类型");return}if(!m.value.liftingName){o.warning("请输入吊索具名称");return}if(!m.value.prodBusiness){o.warning("请输入生产厂家");return}try{const t={...m.value};if(m.value.subType){const i=w.value.find(U=>U.liftingType===m.value.subType);i&&(t.twoLiftingType=i.liftingType,t.twoLiftingName=i.liftingTypeName)}const e=await Re(t);e&&e.code==="0"?(o.success("创建成功"),k.value=!1,z.push({path:"/rigging-detail",query:{id:e.data.id,liftingType:m.value.liftingType,liftingName:m.value.liftingName,prodBusiness:m.value.prodBusiness,subType:t.twoLiftingType||"",subTypeName:t.twoLiftingName||""}})):o.error((e==null?void 0:e.message)||"创建失败")}catch(t){console.error("创建吊索具失败:",t),o.error("创建失败，请检查网络连接")}},B=async()=>{R.value=!0;try{const t=await Pe({pageNum:L.value,pageSize:oe.value});if(t&&t.code==="0"){const e=t.data.records||[];P.value=e.map(i=>({...i,type:ve(i.type)})),ie.value=t.data.total||0}else o.error((t==null?void 0:t.message)||"获取起重机数据失败")}catch(t){console.error("获取起重机数据失败:",t),o.error("获取数据失败，请检查网络连接")}finally{R.value=!1}},Te=t=>{L.value=t,B()},T=async()=>{F.value=!0;try{const t=await Se({pageNum:h.value,pageSize:S.value});if(t&&t.code==="0"){const e=t.data.records||[];$.value=e.map(i=>({...i,liftingType:te(i.liftingType)})),re.value=t.data.total||0}else o.error((t==null?void 0:t.message)||"获取数据失败")}catch(t){console.error("获取吊索具数据失败:",t),o.error("获取数据失败，请检查网络连接")}finally{F.value=!1}},Ce=t=>{h.value=t,T()};let W=null;const Ne=()=>{W&&clearTimeout(W),W=setTimeout(()=>{h.value=1,T()},500)};me(b,t=>{t==="rigging"&&$.value.length===0?T():t==="crane"&&P.value.length===0&&B()});const ke=async()=>{if(!d.value.name){o.warning("请输入设备名称");return}if(!d.value.model){o.warning("请输入型号");return}if(!d.value.manufacturer){o.warning("请输入生产厂家");return}try{const t={...d.value,prodBusiness:d.value.manufacturer};setTimeout(()=>{o.success(d.value.id?"编辑成功":"创建成功"),_.value=!1,q()},500)}catch(t){console.error("操作失败:",t),o.error("操作失败，请检查网络连接")}},q=async()=>{M.value=!0;try{setTimeout(()=>{I.value=[{id:1,name:"换热器",type:"设备",model:"HH-HH",prodBusiness:"xxxxxx",createName:"admin",createTime:"2025-01-01 12:00:00",weight:"HHHH",length:"HfHfH",width:"HHHH",height:"HHHH"}],pe.value=I.value.length,M.value=!1},500)}catch(t){console.error("获取设备数据失败:",t),o.error("获取数据失败，请检查网络连接"),M.value=!1}},xe=t=>{E.value=t,q()};return me(b,t=>{t==="rigging"&&$.value.length===0?T():t==="crane"&&P.value.length===0?B():t==="equipment"&&I.value.length===0&&q()}),De(()=>{b.value==="rigging"?T():b.value==="crane"?B():b.value==="equipment"&&q()}),(t,e)=>{const i=v("el-input"),U=v("el-icon"),g=v("el-button"),r=v("el-table-column"),G=v("el-table"),J=v("el-pagination"),K=v("el-tab-pane"),Be=v("el-tabs"),qe=v("el-card"),f=v("el-form-item"),C=v("el-option"),Q=v("el-select"),X=v("el-form"),Y=v("el-dialog"),Z=ze("loading");return y(),ee("div",Ae,[l(qe,{class:"page-card"},{header:n(()=>[...e[28]||(e[28]=[c("div",{class:"card-header"},[c("span",null,"数据管理")],-1)])]),default:n(()=>[c("div",Oe,[l(Be,{modelValue:b.value,"onUpdate:modelValue":e[6]||(e[6]=a=>b.value=a),class:"data-tabs"},{default:n(()=>[l(K,{label:"起重机数据库",name:"crane"},{default:n(()=>[c("div",je,[c("div",We,[l(i,{modelValue:ne.value,"onUpdate:modelValue":e[0]||(e[0]=a=>ne.value=a),placeholder:"搜索","prefix-icon":"Search",style:{width:"240px"},clearable:""},null,8,["modelValue"]),l(g,{type:"primary",onClick:be},{default:n(()=>[l(U,null,{default:n(()=>[l(V(le))]),_:1}),e[29]||(e[29]=p(" 新建 ",-1))]),_:1})]),ae((y(),D(G,{data:P.value,style:{width:"100%"},"header-cell-style":{background:"#f5f7fa"}},{default:n(()=>[l(r,{type:"selection",width:"55"}),l(r,{label:"序号",width:"80"},{default:n(a=>[p(N(a.$index+1+(h.value-1)*S.value),1)]),_:1}),l(r,{prop:"machineName",label:"起重机名称","min-width":"150"}),l(r,{prop:"type",label:"类型","min-width":"120"},{default:n(a=>[p(N(V(ve)(a.row.type)),1)]),_:1}),l(r,{prop:"model",label:"型号","min-width":"150"}),l(r,{prop:"prodBusiness",label:"生产厂家","min-width":"150"}),l(r,{prop:"createName",label:"创建人",width:"120"}),l(r,{prop:"createTime",label:"录入时间",width:"180"}),l(r,{label:"操作",width:"150",fixed:"right"},{default:n(a=>[l(g,{link:"",type:"primary",size:"small",onClick:H=>O(a.row,"crane")},{default:n(()=>[...e[30]||(e[30]=[p(" 编辑 ",-1)])]),_:1},8,["onClick"]),l(g,{link:"",type:"danger",size:"small",onClick:H=>j(a.row,"crane")},{default:n(()=>[...e[31]||(e[31]=[p(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Z,R.value]]),l(J,{"current-page":L.value,"onUpdate:currentPage":e[1]||(e[1]=a=>L.value=a),"page-size":oe.value,total:ie.value,layout:"total, prev, pager, next",class:"pagination",onCurrentChange:Te},null,8,["current-page","page-size","total"])])]),_:1}),l(K,{label:"吊索具数据库",name:"rigging"},{default:n(()=>[c("div",Ge,[c("div",Je,[l(i,{modelValue:ue.value,"onUpdate:modelValue":e[2]||(e[2]=a=>ue.value=a),placeholder:"搜索","prefix-icon":"Search",style:{width:"240px"},clearable:"",onInput:Ne},null,8,["modelValue"]),l(g,{type:"primary",onClick:he},{default:n(()=>[l(U,null,{default:n(()=>[l(V(le))]),_:1}),e[32]||(e[32]=p(" 新建 ",-1))]),_:1})]),ae((y(),D(G,{data:$.value,style:{width:"100%"},"header-cell-style":{background:"#f5f7fa"}},{default:n(()=>[l(r,{type:"selection",width:"55"}),l(r,{label:"序号",width:"80"},{default:n(a=>[p(N(a.$index+1+(h.value-1)*S.value),1)]),_:1}),l(r,{prop:"liftingName",label:"吊索具名称","min-width":"150"}),l(r,{prop:"liftingType",label:"类型","min-width":"120"},{default:n(a=>[p(N(V(te)(a.row.liftingType)),1)]),_:1}),l(r,{prop:"twoLiftingName",label:"子类型",width:"120"}),l(r,{prop:"prodBusiness",label:"生产厂家","min-width":"150"}),l(r,{prop:"createName",label:"创建人",width:"80"}),l(r,{prop:"createTime",label:"录入时间",width:"180"}),l(r,{label:"操作",width:"150",fixed:"right"},{default:n(a=>[l(g,{link:"",type:"primary",size:"small",onClick:H=>O(a.row,"rigging")},{default:n(()=>[...e[33]||(e[33]=[p(" 编辑 ",-1)])]),_:1},8,["onClick"]),l(g,{link:"",type:"danger",size:"small",onClick:H=>j(a.row,"rigging")},{default:n(()=>[...e[34]||(e[34]=[p(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Z,F.value]]),l(J,{"current-page":h.value,"onUpdate:currentPage":e[3]||(e[3]=a=>h.value=a),"page-size":S.value,total:re.value,layout:"total, prev, pager, next",class:"pagination",onCurrentChange:Ce},null,8,["current-page","page-size","total"])])]),_:1}),l(K,{label:"设备数据库",name:"equipment"},{default:n(()=>[c("div",Ke,[c("div",Qe,[l(i,{modelValue:de.value,"onUpdate:modelValue":e[4]||(e[4]=a=>de.value=a),placeholder:"搜索","prefix-icon":"Search",style:{width:"240px"},clearable:""},null,8,["modelValue"]),l(g,{type:"primary",onClick:we},{default:n(()=>[l(U,null,{default:n(()=>[l(V(le))]),_:1}),e[35]||(e[35]=p(" 新建 ",-1))]),_:1})]),ae((y(),D(G,{data:I.value,style:{width:"100%"},"header-cell-style":{background:"#f5f7fa"}},{default:n(()=>[l(r,{type:"selection",width:"55"}),l(r,{label:"序号",width:"80"},{default:n(a=>[p(N(a.$index+1+(E.value-1)*se.value),1)]),_:1}),l(r,{prop:"name",label:"设备名称","min-width":"150"}),l(r,{prop:"type",label:"型号","min-width":"120"},{default:n(a=>[p(N(V(te)(a.row.type)),1)]),_:1}),l(r,{prop:"prodBusiness",label:"生产厂家","min-width":"150"}),l(r,{prop:"createName",label:"创建人",width:"120"}),l(r,{prop:"createTime",label:"录入时间",width:"180"}),l(r,{label:"操作",width:"150",fixed:"right"},{default:n(a=>[l(g,{link:"",type:"primary",size:"small",onClick:H=>O(a.row,"equipment")},{default:n(()=>[...e[36]||(e[36]=[p(" 编辑 ",-1)])]),_:1},8,["onClick"]),l(g,{link:"",type:"danger",size:"small",onClick:H=>j(a.row,"equipment")},{default:n(()=>[...e[37]||(e[37]=[p(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Z,M.value]]),l(J,{"current-page":E.value,"onUpdate:currentPage":e[5]||(e[5]=a=>E.value=a),"page-size":se.value,total:pe.value,layout:"total, prev, pager, next",class:"pagination",onCurrentChange:xe},null,8,["current-page","page-size","total"])])]),_:1})]),_:1},8,["modelValue"])])]),_:1}),l(Y,{modelValue:x.value,"onUpdate:modelValue":e[12]||(e[12]=a=>x.value=a),title:"新建起重机",width:"500px","close-on-click-modal":!1},{footer:n(()=>[c("div",Xe,[l(g,{onClick:e[11]||(e[11]=a=>x.value=!1)},{default:n(()=>[...e[38]||(e[38]=[p("取消",-1)])]),_:1}),l(g,{type:"primary",onClick:Ve},{default:n(()=>[...e[39]||(e[39]=[p("下一步",-1)])]),_:1})])]),default:n(()=>[l(X,{model:s.value,"label-width":"100px"},{default:n(()=>[l(f,{label:"起重机名称"},{default:n(()=>[l(i,{modelValue:s.value.machineName,"onUpdate:modelValue":e[7]||(e[7]=a=>s.value.machineName=a),placeholder:"请输入（例如：WDT型）"},null,8,["modelValue"])]),_:1}),l(f,{label:"起重机类型"},{default:n(()=>[l(Q,{modelValue:s.value.type,"onUpdate:modelValue":e[8]||(e[8]=a=>s.value.type=a),placeholder:"请选择起重机类型"},{default:n(()=>[(y(!0),ee(ge,null,fe(V($e)(),a=>(y(),D(C,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(f,{label:"型号"},{default:n(()=>[l(i,{modelValue:s.value.model,"onUpdate:modelValue":e[9]||(e[9]=a=>s.value.model=a),placeholder:"请输入型号"},null,8,["modelValue"])]),_:1}),l(f,{label:"生产厂家"},{default:n(()=>[l(i,{modelValue:s.value.prodBusiness,"onUpdate:modelValue":e[10]||(e[10]=a=>s.value.prodBusiness=a),placeholder:"请输入生产厂家（例如：三一重工）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(Y,{modelValue:k.value,"onUpdate:modelValue":e[18]||(e[18]=a=>k.value=a),title:"新建吊索具",width:"500px","close-on-click-modal":!1},{footer:n(()=>[c("div",Ye,[l(g,{onClick:e[17]||(e[17]=a=>k.value=!1)},{default:n(()=>[...e[40]||(e[40]=[p("取消",-1)])]),_:1}),l(g,{type:"primary",onClick:_e},{default:n(()=>[...e[41]||(e[41]=[p("下一步",-1)])]),_:1})])]),default:n(()=>[l(X,{model:m.value,"label-width":"100px"},{default:n(()=>[l(f,{label:"吊索具名称"},{default:n(()=>[l(i,{modelValue:m.value.liftingName,"onUpdate:modelValue":e[13]||(e[13]=a=>m.value.liftingName=a),placeholder:"请输入吊索具名称"},null,8,["modelValue"])]),_:1}),l(f,{label:"吊索具类型"},{default:n(()=>[l(Q,{modelValue:m.value.liftingType,"onUpdate:modelValue":e[14]||(e[14]=a=>m.value.liftingType=a),placeholder:"请选择吊索具类型",onChange:ye},{default:n(()=>[l(C,{label:"钢丝绳",value:"0"}),l(C,{label:"吊带",value:"1"}),l(C,{label:"卸扣",value:"2"}),l(C,{label:"缆绳",value:"3"})]),_:1},8,["modelValue"])]),_:1}),l(f,{label:"子类型"},{default:n(()=>[l(Q,{modelValue:m.value.subType,"onUpdate:modelValue":e[15]||(e[15]=a=>m.value.subType=a),placeholder:"请选择子类型"},{default:n(()=>[(y(!0),ee(ge,null,fe(w.value,a=>(y(),D(C,{key:a.liftingType,label:a.liftingTypeName,value:a.liftingType},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(f,{label:"生产厂家"},{default:n(()=>[l(i,{modelValue:m.value.prodBusiness,"onUpdate:modelValue":e[16]||(e[16]=a=>m.value.prodBusiness=a),placeholder:"请输入生产厂家"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(Y,{modelValue:_.value,"onUpdate:modelValue":e[27]||(e[27]=a=>_.value=a),title:A.value,width:"500px","close-on-click-modal":!1},{footer:n(()=>[c("div",Ze,[l(g,{onClick:e[26]||(e[26]=a=>_.value=!1)},{default:n(()=>[...e[42]||(e[42]=[p("取消",-1)])]),_:1}),l(g,{type:"primary",onClick:ke},{default:n(()=>[...e[43]||(e[43]=[p("确定",-1)])]),_:1})])]),default:n(()=>[l(X,{model:d.value,"label-width":"100px"},{default:n(()=>[l(f,{label:"设备名称"},{default:n(()=>[l(i,{modelValue:d.value.name,"onUpdate:modelValue":e[19]||(e[19]=a=>d.value.name=a),placeholder:"请输入设备名称"},null,8,["modelValue"])]),_:1}),l(f,{label:"型号"},{default:n(()=>[l(i,{modelValue:d.value.model,"onUpdate:modelValue":e[20]||(e[20]=a=>d.value.model=a),placeholder:"请输入型号"},null,8,["modelValue"])]),_:1}),l(f,{label:"生产厂家"},{default:n(()=>[l(i,{modelValue:d.value.manufacturer,"onUpdate:modelValue":e[21]||(e[21]=a=>d.value.manufacturer=a),placeholder:"请输入生产厂家"},null,8,["modelValue"])]),_:1}),l(f,{label:"重量(kg)"},{default:n(()=>[l(i,{modelValue:d.value.weight,"onUpdate:modelValue":e[22]||(e[22]=a=>d.value.weight=a),placeholder:"请输入重量"},null,8,["modelValue"])]),_:1}),l(f,{label:"长度(m)"},{default:n(()=>[l(i,{modelValue:d.value.length,"onUpdate:modelValue":e[23]||(e[23]=a=>d.value.length=a),placeholder:"请输入长度"},null,8,["modelValue"])]),_:1}),l(f,{label:"宽度(m)"},{default:n(()=>[l(i,{modelValue:d.value.width,"onUpdate:modelValue":e[24]||(e[24]=a=>d.value.width=a),placeholder:"请输入宽度"},null,8,["modelValue"])]),_:1}),l(f,{label:"高度(m)"},{default:n(()=>[l(i,{modelValue:d.value.height,"onUpdate:modelValue":e[25]||(e[25]=a=>d.value.height=a),placeholder:"请输入高度"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},nl=Ue(el,[["__scopeId","data-v-0b095086"]]);export{nl as default};
